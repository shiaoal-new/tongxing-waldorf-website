# æª”æ¡ˆè·¯å¾‘: .github/workflows/deploy.yml

name: Deploy Next.js Static Site to GitHub Pages

# 1. è§¸ç™¼æ¢ä»¶
# ç•¶ç¨‹å¼ç¢¼è¢«æ¨é€åˆ° 'main' åˆ†æ”¯æ™‚ï¼Œè§¸ç™¼æ­¤å·¥ä½œæµç¨‹ã€‚
on:
  push:
    branches: ["main"]

  # å…è¨±å¾ Actions é é¢æ‰‹å‹•é‹è¡Œæ­¤ workflow
  workflow_dispatch:

# è¨­ç½®æ¬Šé™ï¼Œç”¨æ–¼éƒ¨ç½²éœæ…‹é é¢
permissions:
  contents: read
  pages: write
  id-token: write

# 2. å·¥ä½œ (Jobs) å®šç¾©
jobs:
  # æ§‹å»º (Build) ç¶²ç«™
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # è¨­ç½® Node.js ç’°å¢ƒ
      - name: Set up Node
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm' # ä½¿ç”¨ npm ç·©å­˜

      # å®‰è£ä¾è³´ (å¦‚æœä½¿ç”¨ pnpm æˆ– yarnï¼Œè«‹ä¿®æ”¹æ­¤æ­¥é©Ÿ)
      - name: Install dependencies
        run: npm install

      # æ§‹å»ºç¶²ç«™ (æœƒåŸ·è¡Œ next build ä¸¦æ ¹æ“š next.config.js ç”Ÿæˆ out è³‡æ–™å¤¾)
      - name: Build static website
        run: npm run build
        # ç¢ºä¿æ‚¨çš„ package.json ä¸­ 'build' è…³æœ¬æ˜¯ 'next build'

      # è¨­ç½® GitHub Pages ç’°å¢ƒ
      - name: Setup Pages
        uses: actions/configure-pages@v5

      # ä¸Šå‚³æ§‹å»ºæˆå“ (out è³‡æ–™å¤¾)
      # å°‡ 'out' è³‡æ–™å¤¾å…§å®¹æ‰“åŒ…ç‚º artifact
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          # ğŸš¨ é—œéµæ­¥é©Ÿï¼šæŒ‡å®š Next.js éœæ…‹å°å‡ºçš„è³‡æ–™å¤¾
          path: './out'

  # éƒ¨ç½² (Deploy) ç¶²ç«™
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    # ç¢ºä¿åœ¨ build æ­¥é©Ÿå®Œæˆå¾Œæ‰é‹è¡Œ deploy
    needs: build
    runs-on: ubuntu-latest
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4