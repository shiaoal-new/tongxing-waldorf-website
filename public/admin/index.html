<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>學校網站內容管理</title>
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/hithismani/responsive-decap@main/dist/responsive.css">
    <!-- 引入 YAML 解析器 -->
    <script src="https://unpkg.com/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
</head>

<script>
    // 告知 CMS 我們要手動初始化，避免它自動抓取 default config.yml
    window.CMS_MANUAL_INIT = true;
</script>
<script src="https://unpkg.com/decap-cms@^3.0/dist/decap-cms.js"></script>
<script>
    async function initCMS() {
        try {
            // 加載配置
            const [configBaseRes, collectionsRes] = await Promise.all([
                fetch('config.base.yml'),
                fetch('collections.yml')
            ]);

            const [configBaseText, collectionsText] = await Promise.all([
                configBaseRes.text(),
                collectionsRes.text()
            ]);

            const config = jsyaml.load(configBaseText);
            const collections = jsyaml.load(collectionsText);

            config.collections = collections;

            // 確保 CMS 已經準備好 init 方法
            if (window.CMS) {
                window.CMS.init({ config });
            }
        } catch (error) {
            console.error("CMS 初始化失敗:", error);
        }
    }

    // 執行初始化
    initCMS();
</script>
</body>

</html>